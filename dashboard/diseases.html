<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Ù‚Ø³Ù… Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ - Ù†Ø¸Ø§Ù… Ø·Ø¨ÙŠ Ù…ØªÙ‚Ø¯Ù…</title>
  <script src="https://js.puter.com/v2/"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@300;400;700&display=swap" rel="stylesheet">
  <style>
    /* CSS Variables Ù„Ù„Ù€Themes (Ù…Ø¯Ù…Ø¬ Ù…Ø¹ dashboard.html) */
    :root {
      /* Light Mode (Ø§ÙØªØ±Ø§Ø¶ÙŠ) */
      --bg-color: #f5f7fb;
      --card-bg: #ffffff;
      --text-color: #111827;
      --secondary-text: #6b7280;
      --border-color: #d1d5db;
      --primary-blue: #1e88e5;
      --button-bg: #1e88e5;
      --button-hover: #0d9488;
      --secondary-button-bg: #f1f1f1;
      --secondary-button-hover: #ddd;
      --notice-bg: #fff7ed;
      --notice-border: #f59e0b;
      --notice-text: #92400e;
      --danger-bg: #fee2e2;
      --danger-border: #ef4444;
      --danger-text: #dc2626;
      --pre-bg: #0f172a;
      --pre-text: #f8fafc;
      --shadow-light: rgba(0,0,0,.08);
      --table-border: #e5e7eb;
      --table-even: #f9fafb;
      --icon-color: #1e88e5;
      --spinner-border: rgba(0,0,0,0.08);
      --conf-high: #16a34a;
      --conf-moderate: #f97316;
      --conf-low: #dc2626;
      --animated-text-color: #60a5fa; /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ */
      --info-box-bg: #f1f1f1; /* Ù„Ù„Ù€ info-boxes ÙÙŠ light */
      --info-box-shadow: rgba(0,0,0,0.05); /* Ù„Ù„Ù€ shadow ÙÙŠ light */
      --search-bg: rgba(255, 255, 255, 0.9);
      --btn-primary: linear-gradient(135deg, #1e88e5, #42a5f5);
      --btn-search: linear-gradient(135deg, #ff9800, #ffb74d);
    }

    [data-theme="dark"] {
      /* Dark Mode */
      --bg-color: #1a1a1a;
      --card-bg: #2c2c2c;
      --text-color: #f3f4f6;
      --secondary-text: #9ca3af;
      --border-color: #4b5563;
      --primary-blue: #64b5f6;
      --button-bg: #0d9488;
      --button-hover: #0f766e;
      --secondary-button-bg: #2a2a2a;
      --secondary-button-hover: #3a3a3a;
      --notice-bg: #7c2d12;
      --notice-border: #dc2626;
      --notice-text: #fecaca;
      --danger-bg: #991b1b;
      --danger-border: #b91c1c;
      --danger-text: #fca5a5;
      --pre-bg: #374151;
      --pre-text: #f3f4f6;
      --shadow-light: rgba(0,0,0,.3);
      --table-border: #374151;
      --table-even: #1f2937;
      --icon-color: #64b5f6;
      --spinner-border: rgba(255,255,255,0.1);
      --conf-high: #16a34a;
      --conf-moderate: #f97316;
      --conf-low: #dc2626;
      --animated-text-color: #a5b4fc; /* Ù„ÙˆÙ† Ø§Ù„Ù†Øµ Ø§Ù„Ù…ØªØ­Ø±Ùƒ ÙÙŠ Ø§Ù„Ø¯Ø§Ø±Ùƒ */
      --info-box-bg: #2a2a2a; /* Ù„Ù„Ù€ info-boxes ÙÙŠ dark */
      --info-box-shadow: rgba(255,255,255,0.05); /* Ù„Ù„Ù€ shadow ÙÙŠ dark */
      --search-bg: rgba(30, 40, 50, 0.95);
      --btn-primary: linear-gradient(135deg, #0d47a1, #1976d2);
      --btn-search: linear-gradient(135deg, #f57c00, #ff9800);
    }

    body {
      margin: 0;
      font-family: 'Tajawal', sans-serif;
      background: var(--bg-color);
      color: var(--text-color);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      transition: background 0.5s ease, color 0.5s ease;
    }

    a { text-decoration: none; }

    /* Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù…Ø¯Ù…Ø¬ Ù…Ù† dashboard.html Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„: Ø²Ø± Ø±Ø¬ÙˆØ¹) */
    header {
      background: var(--primary-blue);
      color: #fff;
      padding: 15px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background-color 0.3s;
      box-shadow: 0 2px 8px var(--shadow-light);
    }

    header .logo {
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    header h1 {
      font-size: 24px;
      margin: 0;
      display: flex;
      align-items: center;
      gap: 8px;
      color: #fff;
    }

    header small {
      font-size: 13px;
      color: #e3f2fd;
      margin-top: 2px;
    }

    /* Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ (Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† hamburger) */
    #back-btn {
      font-size: 26px;
      background: var(--secondary-button-bg);
      border: none;
      color: var(--text-color);
      cursor: pointer;
      border-radius: 8px;
      padding: 6px 10px;
      transition: background 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
      font-family: inherit;
      font-weight: bold;
    }

    #back-btn:hover { 
      background: var(--secondary-button-hover);
    }

    /* Ø§Ù„ÙÙˆØªØ± (Ù…Ø¯Ù…Ø¬ Ù…Ù† dashboard.html) */
    footer {
      text-align: center;
      padding: 15px;
      background: var(--primary-blue);
      color: #fff;
      font-size: 14px;
      transition: background-color 0.3s;
      margin-top: auto; /* Ù„Ø¯ÙØ¹ Ø§Ù„ÙÙˆØªØ± Ù„Ù„Ø£Ø³ÙÙ„ */
    }

    .welcome-phrase {
      text-align: center;
      font-size: 16px;
      font-weight: 500;
      color: var(--animated-text-color);
      margin: 15px 20px;
      padding: 10px 20px;
      border-radius: 25px;
      background: linear-gradient(135deg, rgba(96, 165, 250, 0.1), rgba(96, 165, 250, 0.05));
      backdrop-filter: blur(10px);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
      position: relative;
      overflow: hidden;
    }

    [data-theme="dark"] .welcome-phrase {
      background: linear-gradient(135deg, rgba(165, 180, 252, 0.1), rgba(165, 180, 252, 0.05));
    }

    .welcome-phrase i {
      color: var(--icon-color);
    }

    .main-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      padding: 20px 20px 40px;
      max-width: 800px;
      margin: 0 auto;
      width: 100%;
      box-sizing: border-box;
    }

    /* Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª / Ø§Ù„Ø¹Ø¯Ø¯ (Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶: row Ø¯Ø§Ø¦Ù…Ù‹Ø§ØŒ responsive column) */
    .info-boxes {
      display: flex;
      justify-content: space-around;
      gap: 20px;
      text-align: center;
      margin: 20px 0;
      width: 100%;
    }

    .info-boxes div {
      flex: 1;
      background: var(--info-box-bg);
      padding: 15px;
      border-radius: 10px;
      box-shadow: 0 2px 6px var(--info-box-shadow);
      transition: background-color 0.3s, box-shadow 0.3s;
    }

    .info-boxes h4 {
      margin-bottom: 10px;
      color: var(--primary-blue);
      transition: color 0.3s;
      font-size: 14px;
    }

    .info-boxes p {
      margin: 0;
      font-size: 16px;
      color: var(--text-color);
    }

    .search-container {
      background: var(--card-bg);
      padding: 40px;
      border-radius: 20px;
      box-shadow: 0 6px 20px var(--shadow-light);
      width: 100%;
      text-align: center;
      backdrop-filter: blur(10px);
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .search-container h2 {
      font-size: 24px;
      margin-bottom: 20px;
      color: var(--primary-blue);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .search-input-group {
      position: relative;
      margin-bottom: 20px;
    }

    #diseaseSearch {
      width: 100%;
      padding: 15px 20px 15px 50px;
      border: 2px solid var(--border-color);
      border-radius: 12px;
      font-size: 18px;
      box-sizing: border-box;
      transition: all 0.3s ease;
      background: var(--search-bg);
      color: var(--text-color);
      font-family: 'Tajawal', sans-serif;
      direction: rtl;
    }

    #diseaseSearch:focus {
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 3px rgba(30,136,229,0.1);
      outline: none;
    }

    .search-icon {
      position: absolute;
      left: 15px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--icon-color);
      font-size: 20px;
      z-index: 1;
    }

    .suggestions-container {
      margin-top: 20px;
      display: none;
      background: var(--card-bg);
      border-radius: 12px;
      box-shadow: 0 4px 12px var(--shadow-light);
      max-height: 400px;
      overflow-y: auto;
      border: 1px solid var(--border-color);
      transition: all 0.3s ease;
    }

    .suggestions-container.show {
      display: block;
      animation: slideDown 0.3s ease;
    }

    .suggestion-item {
      padding: 15px 20px;
      border-bottom: 1px solid var(--border-color);
      cursor: pointer;
      transition: all 0.2s ease;
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--text-color);
      font-weight: 400;
    }

    .suggestion-item:hover,
    .suggestion-item.selected {
      background: rgba(30,136,229,0.05);
      color: var(--primary-blue);
      transform: translateX(-5px);
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .suggestion-item i {
      font-size: 16px;
      color: var(--icon-color);
      width: 20px;
    }

    .no-results {
      padding: 20px;
      text-align: center;
      color: var(--secondary-text);
      font-style: italic;
    }

    .ai-btn {
      background: var(--btn-primary);
      color: #fff;
      border: none;
      padding: 15px 30px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px auto 0;
      width: fit-content;
    }

    .ai-btn:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px var(--shadow-light);
    }

    .ai-btn:disabled {
      background: var(--border-color);
      cursor: not-allowed;
      transform: none;
    }

    .ai-btn.loading::after {
      content: '';
      display: inline-block;
      width: 16px;
      height: 16px;
      border: 2px solid transparent;
      border-top: 2px solid #fff;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    .disclaimer {
      font-size: 12px;
      color: var(--secondary-text);
      text-align: center;
      margin-top: 20px;
      font-style: italic;
    }

    .selected-disease {
      background: linear-gradient(135deg, rgba(30,136,229,0.1), rgba(30,136,229,0.05));
      padding: 20px;
      border-radius: 10px;
      margin-top: 15px;
      text-align: center;
      border-left: 4px solid var(--primary-blue);
      display: none;
    }

    .selected-disease.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    .disease-description {
      font-size: 16px;
      margin: 10px 0;
      font-weight: 500;
      color: var(--secondary-text);
    }

    /* ÙƒØ§Ø±Ø¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† AI (Ù…Ø«Ù„ response ÙÙŠ xray) */
    #aiResponse {
      margin-top: 20px;
      display: none;
      background: var(--card-bg);
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 6px 20px var(--shadow-light);
      border-left: 4px solid var(--primary-blue);
    }

    #aiResponse.show {
      display: block;
      animation: fadeIn 0.5s ease;
    }

    #aiResponse h3 {
      color: var(--primary-blue);
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin-top: 0;
    }

    #aiResponse pre {
      white-space: pre-wrap;
      background: var(--pre-bg);
      color: var(--pre-text);
      padding: 15px;
      border-radius: 8px;
      font-size: 14px;
      overflow: auto;
      direction: rtl;
      text-align: right;
    }

    .action-buttons {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      justify-content: center;
    }

    .action-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      flex: 1;
      max-width: 150px;
    }

    .copy-btn {
      background: #2980b9;
    }

    .copy-btn:hover {
      background: #3498db;
    }

    .print-btn {
      background: #27ae60;
    }

    .print-btn:hover {
      background: #2ecc71;
    }

    @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

    /* Responsive */
    @media (max-width: 768px) {
      header { padding: 10px 15px; }
      header h1 { font-size: 20px; }
      #back-btn { font-size: 18px; padding: 8px 12px; }
      .welcome-phrase { margin: 10px 15px; font-size: 14px; }
      .main-content { padding: 10px 15px 20px; }
      .search-container { padding: 20px; margin: 10px; }
      #diseaseSearch { font-size: 16px; padding: 12px 15px 12px 40px; }
      .info-boxes { flex-direction: column; gap: 10px; }
      .action-buttons { flex-direction: column; }
      footer { padding: 10px; font-size: 12px; }
    }

    /* Dark Mode ØªØ­Ø³ÙŠÙ†Ø§Øª (Ù…Ø¯Ù…Ø¬ Ù…Ù† dashboard.html) */
    [data-theme="dark"] input,
    [data-theme="dark"] select,
    [data-theme="dark"] textarea {
      background: var(--card-bg) !important;
      color: var(--text-color) !important;
      border-color: var(--border-color) !important;
    }

    [data-theme="dark"] input::placeholder,
    [data-theme="dark"] textarea::placeholder {
      color: var(--secondary-text) !important;
    }

    [data-theme="dark"] input::-webkit-input-placeholder,
    [data-theme="dark"] textarea::-webkit-input-placeholder {
      color: var(--secondary-text) !important;
    }

    [data-theme="dark"] input:-ms-input-placeholder,
    [data-theme="dark"] textarea:-ms-input-placeholder {
      color: var(--secondary-text) !important;
    }

    [data-theme="dark"] input[readonly],
    [data-theme="dark"] input[readonly="readonly"] {
      background: var(--card-bg) !important;
      color: var(--text-color) !important;
    }

    [data-theme="dark"] #back-btn {
      background: var(--secondary-button-bg);
      color: var(--text-color);
    }

    [data-theme="dark"] #back-btn:hover {
      background: var(--secondary-button-hover);
    }
  </style>
</head>
<body data-theme="light">  <!-- Ø§ÙØªØ±Ø§Ø¶ÙŠ lightØŒ ÙŠØªØºÙŠØ± ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§ -->

  <!-- Ø§Ù„Ù‡ÙŠØ¯Ø± (Ù…Ø¯Ù…Ø¬ ÙˆÙ…Ø¹Ø¯Ù„ Ù…Ù† dashboard.html) -->
  <header>
    <div class="logo">
      <h1><i class="fas fa-stethoscope"></i> Ø·Ø¨ÙŠØ¨ÙŠ</h1>
      <small>Ø£ÙˆÙ„ ØªØ·Ø¨ÙŠÙ‚ Ø°ÙƒØ§Ø¡ Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ø·Ø¨ÙŠ ÙÙŠ Ø³ÙˆØ±ÙŠØ§</small>
    </div>
    <button id="back-btn">
      <i class="fas fa-arrow-left"></i> Ø±Ø¬ÙˆØ¹
    </button>
  </header>

  <!-- Ø§Ù„Ù†Øµ Ø§Ù„Ø«Ø§Ø¨Øª ØªØ­Øª Ø§Ù„Ù‡ÙŠØ¯Ø± (ÙƒÙ…Ø§ Ø·Ù„Ø¨Øª: "Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø±Ø§Ø¶Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚ ÙˆØ¢Ù…Ù†") -->
  <div class="welcome-phrase">
    <i class="fas fa-pills"></i> Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ø¹Ø±Ø§Ø¶Ùƒ ÙˆØ§Ø­ØµÙ„ Ø¹Ù„Ù‰ ØªØ­Ù„ÙŠÙ„ Ø¯Ù‚ÙŠÙ‚ ÙˆØ¢Ù…Ù†
  </div>

  <div class="main-content">
    <!-- Ù…Ø±Ø¨Ø¹Ø§Øª Ø§Ù„ØªØ§Ø±ÙŠØ® ÙˆØ§Ù„ÙˆÙ‚Øª / Ø§Ù„Ø¹Ø¯Ø¯ (Ø¨Ø¬Ø§Ù†Ø¨ Ø¨Ø¹Ø¶: row ÙÙŠ Ø§Ù„Ø¯ÙŠØ³ÙƒØªÙˆØ¨ØŒ column ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„) -->
    <div class="card">
      <div class="info-boxes">
        <div>
          <h4>ğŸ“… ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ…</h4>
          <p id="today-date"></p>
        </div>
        <div>
          <h4>ğŸ“ Ø¹Ø¯Ø¯ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª</h4>
          <p id="query-count">0</p>
        </div>
      </div>
    </div>

    <div class="search-container">
      <h2><i class="fas fa-search"></i> Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ø±Ø¶</h2>
      <p style="text-align: center; color: var(--secondary-text); margin-bottom: 20px;">
        Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø¶ (Ù…Ø«Ù„ "Ø¥Ù†ÙÙ„ÙˆÙ†Ø²Ø§") Ù„ØªØ¸Ù‡Ø± Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§
      </p>
      
      <div class="search-input-group">
        <i class="fas fa-search search-icon"></i>
        <input type="text" id="diseaseSearch" placeholder="Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„ÙƒØªØ§Ø¨Ø©... (Ù…Ø«Ø§Ù„: Ø¥Ù†ÙÙ„ÙˆÙ†Ø²Ø§ØŒ Ø³ÙƒØ±ÙŠ)" autocomplete="off">
      </div>

      <!-- Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ§Ø± Ù‡Ù†Ø§ -->
      <div id="selectedDiseaseSection" class="selected-disease">
        <h3><i class="fas fa-check-circle"></i> Ø§Ù„Ù…Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ§Ø±: <span id="selectedDiseaseName"></span></h3>
        <div id="diseaseDescription" class="disease-description">
          Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø± Ø£Ø¯Ù†Ø§Ù‡ Ù„Ø¥Ø±Ø³Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ù…Ø±Ø¶ Ø¥Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ØªÙØ§ØµÙŠÙ„ ÙˆØªØ­Ù„ÙŠÙ„.
        </div>
      </div>

      <div id="suggestionsContainer" class="suggestions-container">
        <!-- Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
      </div>

      <!-- Ø§Ù„Ø²Ø± Ù„Ù„Ù€AI Ø³ÙŠØªÙ… Ø¥Ø¶Ø§ÙØªÙ‡ Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠÙ‹Ø§ -->
      <div id="aiButtonContainer"></div>

      <div class="disclaimer">
        <i class="fas fa-info-circle"></i> Ù‡Ø°Ø§ Ø§Ù„Ù†Ø¸Ø§Ù… Ù„Ù„Ù…Ø³Ø§Ø¹Ø¯Ø© Ø§Ù„Ø·Ø¨ÙŠØ© ÙÙ‚Ø·. Ø§Ø³ØªØ´Ø± Ø·Ø¨ÙŠØ¨Ù‹Ø§ Ù…ØªØ®ØµØµÙ‹Ø§ Ù„Ù„ØªØ´Ø®ÙŠØµ Ø§Ù„Ø¯Ù‚ÙŠÙ‚.
      </div>
    </div>

    <!-- ÙƒØ§Ø±Ø¯ Ø§Ù„Ù†ØªÙŠØ¬Ø© Ù…Ù† AI (Ù…Ø®ÙÙŠ) -->
    <div id="aiResponse" class="card">
      <h3><i class="fas fa-robot"></i> ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ</h3>
      <pre id="aiResultText"></pre>
      <div class="action-buttons">
        <button class="action-btn copy-btn" id="copyAi"><i class="fas fa-copy"></i> Ù†Ø³Ø®</button>
        <button class="action-btn print-btn" onclick="window.print()"><i class="fas fa-print"></i> Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </div>
  </div>

  <!-- Ø§Ù„ÙÙˆØªØ± (Ù…Ø¯Ù…Ø¬ Ù…Ù† dashboard.html) -->
  <footer>Â© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ù…Ø­ÙÙˆØ¸Ø© Ù„Ù€ Kasp-ai</footer>

  <script>
    // Ù…Ø¹Ø§Ù„Ø¬ Ø²Ø± Ø§Ù„Ø±Ø¬ÙˆØ¹ (Ø¬Ø¯ÙŠØ¯: ÙŠØ¹ÙˆØ¯ Ø¥Ù„Ù‰ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø£Ùˆ dashboard.html)
    document.addEventListener('DOMContentLoaded', () => {
      const backBtn = document.getElementById('back-btn');
      if (backBtn) {
        backBtn.addEventListener('click', () => {
          if (window.history.length > 1) {
            window.history.back(); // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ ØªØ§Ø±ÙŠØ®ØŒ Ø§Ø±Ø¬Ø¹ Ù„Ù„Ø®Ù„Ù
          } else {
            window.location.href = 'dashboard.html'; // Ø¥Ù„Ø§ØŒ Ø§Ø°Ù‡Ø¨ Ø¥Ù„Ù‰ dashboard
          }
        });
      }
    });

    // ÙƒÙˆØ¯ Ø§Ù„Ù€Dark Mode Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù…Ø«Ù„ prescription Ùˆ xray)
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
    }

    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    applyTheme(prefersDark ? 'dark' : 'light');

    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
      applyTheme(e.matches ? 'dark' : 'light');
    });

    // ØªØ§Ø±ÙŠØ® ÙˆÙˆÙ‚Øª Ø§Ù„ÙŠÙˆÙ… (Ù…Ø®ØµØµ Ù„Ù„ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨: ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø© Ø³Ø§Ø¹Ø©:Ø¯Ù‚ÙŠÙ‚Ø©:Ø«Ø§Ù†ÙŠØ© Ù…/ØµØŒ Ù…Ø¹ Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ©)
    function updateDateTime() {
      const now = new Date();
      
      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ØªØ§Ø±ÙŠØ®: ÙŠÙˆÙ…/Ø´Ù‡Ø±/Ø³Ù†Ø© (Ù…Ø«Ù„ Ù¢Ù£/Ù©/Ù¢Ù Ù¢Ù¥)
      const dateOptions = { 
        day: 'numeric', 
        month: 'numeric', 
        year: 'numeric',
        timeZone: 'UTC' // Ù„Ø¶Ù…Ø§Ù† Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
      };
      const dateStr = now.toLocaleDateString('ar-EG', dateOptions).replace(/â€/g, ''); // Ø¥Ø²Ø§Ù„Ø© Ø¹Ù„Ø§Ù…Ø§Øª RTL Ø¥Ø°Ø§ Ù„Ø²Ù…
      
      // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„ÙˆÙ‚Øª: Ø³Ø§Ø¹Ø©:Ø¯Ù‚ÙŠÙ‚Ø©:Ø«Ø§Ù†ÙŠØ© Ù…/Øµ (Ù…Ø«Ù„ Ù§:Ù Ù :Ù¢Ù§ Ù…)
      const timeOptions = { 
        hour: 'numeric', 
        minute: '2-digit', 
        second: '2-digit',
        hour12: true // Ù„Ù€ AM/PM (Ù…/Øµ)
      };
      const timeStr = now.toLocaleTimeString('ar-EG', timeOptions).replace(/\s*Ù…\s*/g, ' Ù…').replace(/\s*Øµ\s*/g, ' Øµ');
      
      // Ø¯Ù…Ø¬: Ø§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙˆÙ‚Øª (Ù…Ø«Ù„: Ù¢Ù£/Ù©/Ù¢Ù Ù¢Ù¥ Ù§:Ù Ù :Ù¢Ù§ Ù…)
      const fullStr = `${dateStr.replace(/\//g, 'â€/â€')} ${timeStr}`; // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª RTL Ù„Ù„ÙÙˆØ§ØµÙ„ Ø¥Ø°Ø§ Ù„Ø²Ù…
      
      document.getElementById("today-date").textContent = fullStr;
    }
    setInterval(updateDateTime, 1000); // ØªØ­Ø¯ÙŠØ« ÙƒÙ„ Ø«Ø§Ù†ÙŠØ©
    updateDateTime(); // Ø¹Ø±Ø¶ ÙÙˆØ±ÙŠ

    // Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…Ø§Øª (ÙŠØ²ÙŠØ¯ Ø¹Ù†Ø¯ Ù†Ø¬Ø§Ø­ AI)
    let queryCount = 0;
    const queryCountEl = document.getElementById("query-count");
    function incrementQueryCount() {
      queryCount++;
      queryCountEl.textContent = queryCount;
    }

    let allDiseases = []; // array Ù…Ù† Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ ÙÙ‚Ø·
    let filteredDiseases = [];
    let selectedDisease = null;

    // Ø¨ÙŠØ§Ù†Ø§Øª fallback Ù‚ØµÙŠØ±Ø© (Ø£Ø³Ù…Ø§Ø¡ ÙÙ‚Ø·) Ø¥Ø°Ø§ ÙØ´Ù„ JSON
    const fallbackDiseases = [
      "Ø¥Ù†ÙÙ„ÙˆÙ†Ø²Ø§", "Ø§Ù„ØªÙ‡Ø§Ø¨ Ø§Ù„Ø±Ø¦Ø©", "Ø³ÙƒØ±ÙŠ", "Ø±Ø¨Ùˆ", "Ø£ÙƒØ²ÙŠÙ…Ø§", "Ø­Ø³Ø§Ø³ÙŠØ©", "Ø³Ø±Ø·Ø§Ù†", "Ø§Ù„ØªÙ‡Ø§Ø¨ Ø§Ù„Ù…ÙØ§ØµÙ„",
      "Ø²Ù‡Ø§ÙŠÙ…Ø±", "Ø¨Ø§Ø±ÙƒÙ†Ø³ÙˆÙ†", "Ø§Ù„Ù‚Ù„Ø¨", "Ø§Ù„ÙƒØ¨Ø¯", "ÙƒÙ„Ù‰", "Ø§Ù„Ø¯Ù…Ø§Øº", "Ø§Ù„Ø¬Ù„Ø¯", "Ø§Ù„Ù‚ÙˆÙ„ÙˆÙ†", "Ø§Ù„Ù…Ø¹Ø¯Ø©",
      "Ø§Ù„ØºØ¯Ø© Ø§Ù„Ø¯Ø±Ù‚ÙŠØ©", "Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ", "Ø¥Ø³Ù‡Ø§Ù„"
    ];

    // ØªÙ‡ÙŠØ¦Ø©: ØªØ­Ù…ÙŠÙ„ JSON (Ù…Ø¹ fallback)
    async function init() {
      try {
        const response = await fetch('./scripts/json/diseases.json');
        if (response.ok) {
          const data = await response.json();
          allDiseases = data.diseases || fallbackDiseases;
          console.log(`ØªÙ… ØªØ­Ù…ÙŠÙ„ ${allDiseases.length} Ù…Ø±Ø¶ Ù…Ù† JSON`);
        } else {
          throw new Error('ÙØ´Ù„ ÙÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„');
        }
      } catch (error) {
        console.warn('Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø¨ÙŠØ§Ù†Ø§Øª fallback Ù„Ù„Ø£Ù…Ø±Ø§Ø¶:', error);
        allDiseases = fallbackDiseases;
      }
      setupSearch();
    }

    function setupSearch() {
      const searchInput = document.getElementById('diseaseSearch');
      const suggestionsContainer = document.getElementById('suggestionsContainer');

      searchInput.addEventListener('input', function() {
        const query = this.value.trim().toLowerCase();
        if (query.length < 1) {
          suggestionsContainer.classList.remove('show');
          return;
        }

        filteredDiseases = allDiseases.filter(disease => 
          disease.toLowerCase().includes(query)
        );

        if (filteredDiseases.length === 0) {
          suggestionsContainer.innerHTML = '<div class="no-results"><i class="fas fa-search"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù…Ø·Ø§Ø¨Ù‚Ø©. Ø¬Ø±Ø¨ ÙƒÙ„Ù…Ø§Øª Ø£Ø®Ø±Ù‰.</div>';
        } else {
          let html = '';
          filteredDiseases.slice(0, 20).forEach((disease) => { // Ø­Ø¯ Ø£Ù‚ØµÙ‰ 20 Ù„Ù„Ø£Ø¯Ø§Ø¡
            html += `
              <div class="suggestion-item" onclick="selectDisease('${disease.replace(/'/g, "\\'")}')">
                <i class="fas fa-diagnoses"></i> ${disease}
              </div>
            `;
          });
          if (filteredDiseases.length > 20) {
            html += '<div class="no-results">... Ùˆ${filteredDiseases.length - 20} Ù†ØªØ§Ø¦Ø¬ Ø£Ø®Ø±Ù‰</div>';
          }
          suggestionsContainer.innerHTML = html;
        }

        suggestionsContainer.classList.add('show');
      });

      // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø§Ù‚ØªØ±Ø§Ø­Ø§Øª Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡Ø§
      document.addEventListener('click', function(e) {
        if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
          suggestionsContainer.classList.remove('show');
        }
      });

      // Enter Ù„Ù„Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙˆÙ„
      searchInput.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' && filteredDiseases.length > 0) {
          selectDisease(filteredDiseases[0]);
        }
      });
    }

    function selectDisease(disease) {
      selectedDisease = disease;
      document.getElementById('diseaseSearch').value = disease;
      document.getElementById('suggestionsContainer').classList.remove('show');
      
      // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±Ø¶ Ø§Ù„Ù…Ø®ØªØ§Ø±
      const selectedSection = document.getElementById('selectedDiseaseSection');
      const selectedName = document.getElementById('selectedDiseaseName');
      selectedName.textContent = disease;
      selectedSection.classList.add('show');
      
      // Ø¥Ø¶Ø§ÙØ© Ø²Ø± AI
      sendToAIInline(disease);
    }

    async function sendToAIInline(disease) {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø²Ø± Ø§Ù„Ø³Ø§Ø¨Ù‚ Ø¥Ø°Ø§ Ù…ÙˆØ¬ÙˆØ¯
      const existingBtn = document.querySelector('.ai-btn');
      if (existingBtn) existingBtn.remove();
      
      const aiBtn = document.createElement('button');
      aiBtn.className = 'ai-btn';
      aiBtn.innerHTML = '<i class="fas fa-robot"></i> Ø¥Ø±Ø³Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø§ØµØ·Ù†Ø§Ø¹ÙŠ';
      aiBtn.onclick = async function() {
        this.disabled = true;
        this.classList.add('loading');
        this.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„...';

        try {
          const prompt = `Ø£Ù†Øª Ø·Ø¨ÙŠØ¨ Ù…ØªØ®ØµØµ ÙÙŠ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶. Ù‚Ø¯Ù… ØªØ­Ù„ÙŠÙ„Ù‹Ø§ Ù…ÙØµÙ„Ù‹Ø§ ÙˆØ¯Ù‚ÙŠÙ‚Ù‹Ø§ Ù„Ù„Ù…Ø±Ø¶: "${disease}". 
Ø´Ù…Ù„: Ø§Ù„Ø£Ø¹Ø±Ø§Ø¶ Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©ØŒ Ø§Ù„Ø£Ø³Ø¨Ø§Ø¨ØŒ Ø§Ù„ØªØ´Ø®ÙŠØµØŒ Ø§Ù„Ø¹Ù„Ø§Ø¬ØŒ Ø§Ù„ÙˆÙ‚Ø§ÙŠØ©ØŒ ÙˆØ§Ù„Ù…Ø®Ø§Ø·Ø±. 
Ø§Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø¯ Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŒ Ù…Ù†Ø¸Ù…Ù‹Ø§ØŒ ÙˆØ¢Ù…Ù†Ù‹Ø§ (Ù„Ø§ ØªÙØ´Ø®Ù‘Øµ Ø¨Ø´ÙƒÙ„ Ù†Ù‡Ø§Ø¦ÙŠ).`;

          const completion = await puter.ai.chat([{ role: "user", content: prompt }], { model: "gpt-5" });
          let aiResponse = "";
          if (completion?.message?.content) {
            aiResponse = completion.message.content;
          } else if (completion?.output_text) {
            aiResponse = completion.output_text;
          } else {
            aiResponse = JSON.stringify(completion);
          }

          // Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªÙŠØ¬Ø©
          const aiResultText = document.getElementById('aiResultText');
          aiResultText.textContent = aiResponse;
          document.getElementById('aiResponse').classList.add('show');
          incrementQueryCount(); // Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø¯Ø§Ø¯

          // ØªÙ†Ø¸ÙŠÙ
          this.innerHTML = '<i class="fas fa-robot"></i> Ø¥Ø±Ø³Ø§Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
        } catch (err) {
          alert(`âš ï¸ <i class="fas fa-exclamation-triangle"></i> Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù„ÙŠÙ„: ${err.message}`);
          this.innerHTML = '<i class="fas fa-robot"></i> Ø¥Ø±Ø³Ø§Ù„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰';
        }
        this.disabled = false;
        this.classList.remove('loading');
      };
      document.getElementById('aiButtonContainer').appendChild(aiBtn);
    }

    // Ù†Ø³Ø® Ù†ØªÙŠØ¬Ø© AI
    document.getElementById('copyAi').onclick = () => {
      const aiText = document.getElementById('aiResultText').textContent;
      navigator.clipboard.writeText(aiText).then(() => {
        alert("<i class='fas fa-check'></i> ØªÙ… Ø§Ù„Ù†Ø³Ø® Ø¨Ù†Ø¬Ø§Ø­");
      }).catch(() => {
        alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ù†Ø³Ø®");
      });
    };

    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØµÙØ­Ø©
    init();
  </script>
</body>
</html>